{"version":3,"sources":["webpack:///./node_modules/lodash/_baseSlice.js","webpack:///./node_modules/lodash/concat.js","webpack:///./node_modules/lodash/first.js","webpack:///./src/visualizations/SunburstClock.vue?c99c","webpack:///./node_modules/lodash/head.js","webpack:///./src/visualizations/SunburstClock.vue?56b9","webpack:///./src/visualizations/sunburst-clock.js","webpack:///src/visualizations/SunburstClock.vue","webpack:///./src/visualizations/SunburstClock.vue?1cc1","webpack:///./src/visualizations/SunburstClock.vue?1c1d","webpack:///./node_modules/lodash/tail.js"],"names":["baseSlice","array","start","end","index","length","result","Array","module","exports","arrayPush","baseFlatten","copyArray","isArray","concat","arguments","args","head","undefined","render","_vm","this","_h","$createElement","_c","_self","staticClass","_m","_v","_s","centerMsg","staticRenderFns","staticStyle","d3","require","moment","color","width","height","radius","Math","min","legendData","afk","getColorFromString","hibernating","rootEl","vis","partition","arc","create","el","select","selectAll","remove","append","attr","drawLegend","size","PI","startAngle","d","x0","endAngle","x1","innerRadius","sqrt","y0","outerRadius","y1","drawClockTick","a","xn","cos","yn","sin","style","drawClock","h","m","text","hours","format","update","json","initializeBreadcrumbTrail","querySelector","innerHTML","root","hierarchy","nodes","mode_clock","show_whole_day","root_start","timestamp","root_end","add","duration","startOf","clone","endOf","now","hour","minute","each","loc_start_sec","data","diff","loc_end_sec","loc_start","max","loc_end","descendants","sum","sort","b","JSON","stringify","localeCompare","filter","threshold","enter","depth","status","app","on","mouseover","mouseclick","mouseleave","console","log","showInfo","hoverEl","durationString","seconds_to_duration","title","sequenceArray","ancestors","reverse","shift","node","indexOf","transition","trail","li","w","s","r","legend","keys","g","entries","i","value","key","name","props","starttime","endtime","watch","visualize","mounted","methods","todaysEvents","$aw","getEvents","bucket_id","limit","buildHierarchy","parents","children","afkBucketId","then","windowBucketId","events_afk","events_window","component","tail"],"mappings":"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","file":"js/chunk-4b8d39cb.ef774457.js","sourcesContent":["/**\n * The base implementation of `_.slice` without an iteratee call guard.\n *\n * @private\n * @param {Array} array The array to slice.\n * @param {number} [start=0] The start position.\n * @param {number} [end=array.length] The end position.\n * @returns {Array} Returns the slice of `array`.\n */\nfunction baseSlice(array, start, end) {\n  var index = -1,\n      length = array.length;\n\n  if (start < 0) {\n    start = -start > length ? 0 : (length + start);\n  }\n  end = end > length ? length : end;\n  if (end < 0) {\n    end += length;\n  }\n  length = start > end ? 0 : ((end - start) >>> 0);\n  start >>>= 0;\n\n  var result = Array(length);\n  while (++index < length) {\n    result[index] = array[index + start];\n  }\n  return result;\n}\n\nmodule.exports = baseSlice;\n","var arrayPush = require('./_arrayPush'),\n    baseFlatten = require('./_baseFlatten'),\n    copyArray = require('./_copyArray'),\n    isArray = require('./isArray');\n\n/**\n * Creates a new array concatenating `array` with any additional arrays\n * and/or values.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Array\n * @param {Array} array The array to concatenate.\n * @param {...*} [values] The values to concatenate.\n * @returns {Array} Returns the new concatenated array.\n * @example\n *\n * var array = [1];\n * var other = _.concat(array, 2, [3], [[4]]);\n *\n * console.log(other);\n * // => [1, 2, 3, [4]]\n *\n * console.log(array);\n * // => [1]\n */\nfunction concat() {\n  var length = arguments.length;\n  if (!length) {\n    return [];\n  }\n  var args = Array(length - 1),\n      array = arguments[0],\n      index = length;\n\n  while (index--) {\n    args[index - 1] = arguments[index];\n  }\n  return arrayPush(isArray(array) ? copyArray(array) : [array], baseFlatten(args, 1));\n}\n\nmodule.exports = concat;\n","module.exports = require('./head');\n","import mod from \"-!../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SunburstClock.vue?vue&type=style&index=0&id=6b529888&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SunburstClock.vue?vue&type=style&index=0&id=6b529888&scoped=true&lang=scss&\"","/**\n * Gets the first element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @alias first\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the first element of `array`.\n * @example\n *\n * _.head([1, 2, 3]);\n * // => 1\n *\n * _.head([]);\n * // => undefined\n */\nfunction head(array) {\n  return (array && array.length) ? array[0] : undefined;\n}\n\nmodule.exports = head;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"sunburst\"},[_vm._m(0),_c('div',{staticClass:\"main\"},[_c('div',{staticClass:\"chart\"},[_c('div',{staticClass:\"explanation\"},[_c('div',{staticClass:\"base\"},[_vm._v(_vm._s(_vm.centerMsg))]),_vm._m(1)])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"sidebar\"},[_c('div',{staticClass:\"legend\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"hover\",staticStyle:{\"visibility\":\"hidden\"}},[_c('div',{staticClass:\"date\"}),_c('div',{staticClass:\"title\"}),_c('div',{staticClass:\"time\"}),_c('div',{staticClass:\"duration\"}),_c('div',{staticClass:\"data\",staticStyle:{\"text-overflow\":\"ellipsis\",\"white-space\":\"nowrap\",\"overflow\":\"hidden\"}})])}]\n\nexport { render, staticRenderFns }","// Original source: https://bl.ocks.org/kerryrodden/7090426\n//\n// Copyright 2013 Google Inc. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nconst d3 = require('d3');\nconst moment = require('moment');\n\nimport { seconds_to_duration } from '../util/time.js';\nconst color = require('../util/color.js');\n\n// Dimensions of sunburst.\nconst width = 750;\nconst height = 600;\nconst radius = Math.min(width, height) / 2;\n\nconst legendData = {\n  afk: color.getColorFromString('afk'),\n  'not-afk': color.getColorFromString('not-afk'),\n  hibernating: color.getColorFromString('hibernating'),\n};\n\nlet rootEl; // The root DOM node of the graph as a d3 object\nlet vis; // The root SVG node of the graph as a d3 object\nlet partition;\nlet arc;\n\nfunction create(el) {\n  // Clear the svg in case we are redrawing\n  rootEl = d3.select('.chart');\n  rootEl.selectAll('svg').remove();\n\n  vis = rootEl\n    .append('svg:svg')\n    .attr('width', width)\n    .attr('height', height)\n    .append('svg:g')\n    .attr('id', 'container')\n    .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n\n  drawLegend(el);\n\n  partition = d3.partition().size([2 * Math.PI, radius * radius]);\n\n  arc = d3\n    .arc()\n    .startAngle(function(d) {\n      return d.x0;\n    })\n    .endAngle(function(d) {\n      return d.x1;\n    })\n    .innerRadius(function(d) {\n      return Math.sqrt(d.y0);\n    })\n    .outerRadius(function(d) {\n      return Math.sqrt(d.y1);\n    });\n}\n\nfunction drawClockTick(a) {\n  const xn = Math.cos(a);\n  const yn = Math.sin(a);\n\n  vis\n    .append('line')\n    .attr('x1', 170 * xn)\n    .attr('y1', 170 * yn)\n    .attr('x2', 155 * xn)\n    .attr('y2', 155 * yn)\n    .style('stroke', '#CCC')\n    .style('stroke-width', 1);\n}\n\nfunction drawClock(h, m, text) {\n  const a = 2 * Math.PI * (h / 24 + m / 24 / 60) - (1 / 2) * Math.PI;\n  drawClockTick(a);\n\n  const xn = Math.cos(a);\n  const yn = Math.sin(a);\n\n  vis\n    .append('text')\n    .text(text || moment({ hours: h }).format('HH:mm'))\n    .attr('text-anchor', 'middle')\n    .attr('font-size', '1.2em')\n    //.attr(\"font-weight\", \"bold\")\n    .style('fill', '#999')\n    .attr('x', 130 * xn)\n    .attr('y', 5 + 140 * yn);\n}\n\n// Main function to draw and set up the visualization, once we have the data.\nfunction update(el, json) {\n  // Basic setup of page elements.\n  initializeBreadcrumbTrail();\n\n  el.querySelector('#container').innerHTML = '';\n\n  // Bounding circle underneath the sunburst, to make it easier to detect\n  // when the mouse leaves the parent g.\n  vis\n    .append('svg:circle')\n    .attr('r', radius)\n    .style('opacity', 0);\n\n  // Turn the data into a d3 hierarchy and calculate the sums.\n  let root = d3.hierarchy(json);\n  let nodes = partition(root);\n\n  const mode_clock = true;\n  if (mode_clock) {\n    // TODO: Make this a checkbox in the UI\n    const show_whole_day = true;\n\n    let root_start = moment(json.timestamp);\n    let root_end = moment(json.timestamp).add(json.duration, 'seconds');\n    if (show_whole_day) {\n      root_start = root_start.startOf('day');\n      root_end = root_start.clone().endOf('day');\n\n      drawClock(0, 0);\n      drawClock(6, 0);\n      drawClock(12, 0);\n      drawClock(18, 0);\n\n      // TODO: Draw only if showing today\n      const now = moment();\n      drawClock(now.hour(), now.minute(), 'Now');\n    }\n\n    nodes = nodes\n      .each(function(d) {\n        const loc_start_sec = moment(d.data.timestamp).diff(root_start, 'seconds', true);\n        const loc_end_sec = moment(d.data.timestamp)\n          .add(d.data.duration, 'seconds')\n          .diff(root_start, 'seconds', true);\n\n        const loc_start = Math.max(0, loc_start_sec / ((root_end - root_start) / 1000));\n        const loc_end = Math.min(1, loc_end_sec / ((root_end - root_start) / 1000));\n\n        d.x0 = 2 * Math.PI * loc_start;\n        d.x1 = 2 * Math.PI * loc_end;\n      })\n      .descendants();\n  } else {\n    root = root\n      .sum(d => d.duration)\n      .sort((a, b) => JSON.stringify(a.data.data).localeCompare(JSON.stringify(b.data.data)));\n    nodes = nodes.descendants();\n  }\n\n  // For efficiency, filter nodes to keep only those large enough to see.\n  nodes = nodes.filter(function(d) {\n    // 0.005 radians = 0.29 degrees\n    // If show_whole_day:\n    //   0.0044 rad = 1min\n    //   0.0011 rad = 15s\n    const threshold = 0.001;\n    return d.x1 - d.x0 > threshold;\n  });\n\n  vis\n    .data([json])\n    .selectAll('path')\n    .data(nodes)\n    .enter()\n    .append('svg:path')\n    .attr('display', function(d) {\n      return d.depth ? null : 'none';\n    })\n    .attr('d', arc)\n    .attr('fill-rule', 'evenodd')\n    .style('fill', function(d) {\n      return color.getColorFromString(d.data.data.status || d.data.data.app);\n    })\n    .style('opacity', 1)\n    .on('mouseover', mouseover)\n    .on('click', mouseclick);\n\n  // Add the mouseleave handler to the bounding circle.\n  d3.select('#container').on('mouseleave', mouseleave);\n}\n\nfunction mouseclick(d) {\n  console.log('Clicked');\n  console.log(d);\n}\n\nfunction showInfo(d) {\n  const hoverEl = d3.select('.explanation > .hover');\n\n  const m = moment(d.data.timestamp);\n  hoverEl.select('.date').text(m.format('YYYY-MM-DD'));\n  hoverEl.select('.time').text(m.format('HH:mm:ss'));\n\n  const durationString = seconds_to_duration(d.data.duration);\n  hoverEl.select('.duration').text(durationString);\n\n  hoverEl.select('.title').text(d.data.data.app || d.data.data.status);\n\n  hoverEl.select('.data').text(d.data.data.title || '');\n\n  d3.select('.explanation > .base').style('display', 'none');\n  hoverEl.style('visibility', '');\n}\n\n// Fade all but the current sequence, and show it in the breadcrumb trail.\nfunction mouseover(d) {\n  showInfo(d);\n\n  const sequenceArray = d.ancestors().reverse();\n  sequenceArray.shift(); // remove root node from the array\n\n  // Fade all the segments.\n  rootEl.selectAll('path').style('opacity', 0.5);\n\n  // Then highlight only those that are an ancestor of the current segment.\n  // FIXME: This currently makes all other svg paths on the page faded as well\n  rootEl\n    .selectAll('path')\n    .filter(function(node) {\n      return sequenceArray.indexOf(node) >= 0;\n    })\n    .style('opacity', 1);\n}\n\n// Restore everything to full opacity when moving off the visualization.\nfunction mouseleave() {\n  // Deactivate all segments during transition.\n  rootEl.selectAll('path').on('mouseover', null);\n\n  // Transition each segment to full opacity and then reactivate it.\n  rootEl\n    .selectAll('path')\n    .transition()\n    .duration(100)\n    .style('opacity', 1)\n    .on('end', function() {\n      d3.select(this).on('mouseover', mouseover);\n    });\n\n  rootEl.select('.explanation > .base').style('display', '');\n  rootEl.select('.explanation > .hover').style('visibility', 'hidden');\n}\n\nfunction initializeBreadcrumbTrail() {\n  // Add the svg area.\n  const trail = d3\n    .select('.sequence')\n    .append('svg:svg')\n    .attr('width', width)\n    .attr('height', 50)\n    .attr('id', 'trail');\n  // Add the label at the end, for the percentage.\n  trail\n    .append('svg:text')\n    .attr('id', 'endlabel')\n    .style('fill', '#000');\n}\n\nfunction drawLegend() {\n  // Dimensions of legend item: width, height, spacing, radius of rounded rect.\n  const li = {\n    w: 75,\n    h: 30,\n    s: 3,\n    r: 3,\n  };\n\n  const legend = d3\n    .select('.legend')\n    .append('svg:svg')\n    .attr('width', li.w)\n    .attr('height', d3.keys(legendData).length * (li.h + li.s));\n\n  const g = legend\n    .selectAll('g')\n    .data(d3.entries(legendData))\n    .enter()\n    .append('svg:g')\n    .attr('transform', function(d, i) {\n      return 'translate(0,' + i * (li.h + li.s) + ')';\n    });\n\n  g.append('svg:rect')\n    .attr('rx', li.r)\n    .attr('ry', li.r)\n    .attr('width', li.w)\n    .attr('height', li.h)\n    .style('fill', function(d) {\n      return d.value;\n    });\n\n  g.append('svg:text')\n    .attr('x', li.w / 2)\n    .attr('y', li.h / 2)\n    .attr('dy', '0.35em')\n    .attr('text-anchor', 'middle')\n    .text(function(d) {\n      return d.key;\n    });\n}\n\n// NOTE: The original version of this sunburst contained a buildHierarchy\n//       function that's not used in our version.\n\nexport default {\n  create: create,\n  update: update,\n};\n","<template lang=\"pug\">\ndiv.sunburst\n  div.sidebar\n    div.legend\n\n  div.main\n    div.chart\n      div.explanation\n        div.base\n          | {{ centerMsg }}\n        div.hover(style=\"visibility: hidden\")\n          div.date\n          div.title\n          div.time\n          div.duration\n          div.data(style=\"text-overflow: ellipsis; white-space: nowrap; overflow: hidden;\")\n</template>\n\n<style scoped lang=\"scss\">\n.sunburst {\n  font-family: 'Open Sans', sans-serif;\n  font-size: 12px;\n  font-weight: 400;\n  width: 100%;\n  height: 620px;\n  margin-top: 10px;\n\n  .main {\n    width: 750px;\n    margin-right: auto;\n    margin-left: auto;\n  }\n\n  .sidebar {\n    float: right;\n    height: 0;\n    width: 100px;\n  }\n\n  .sequence {\n    width: 600px;\n    height: 70px;\n  }\n\n  .legend {\n    padding: 10px 0 0 3px;\n  }\n\n  .sequence text, .legend text {\n    font-weight: 600;\n    fill: #fff;\n  }\n\n  .chart {\n    position: relative;\n  }\n\n  .chart path {\n    stroke: #fff;\n  }\n\n  .explanation {\n    position: absolute;\n    top: 260px;\n    left: 305px;\n    width: 140px;\n    text-align: center;\n    color: #666;\n    z-index: 10; // might not be needed\n\n    .base {\n        color: #DDD;\n        font-size: 2em;\n    }\n\n    .hover {\n      .date {\n        font-size: 0.8em;\n      }\n\n      .time {\n        font-size: 1em;\n      }\n\n      .title {\n        font-size: 2em;\n        font-weight: bold;\n      }\n\n      .duration {\n        font-size: 1em;\n      }\n\n      .data {\n        font-size: 1em;\n      }\n    }\n  }\n}\n</style>\n\n<script>\n// NOTE: This is just a Vue.js component wrapper for timeline-simple.js\n//       Code should generally go in the framework-independent file.\n\n// TODO: Sunburst requires a hierarchical data format\n\nimport sunburst from './sunburst-clock.js';\nimport moment from 'moment';\nimport _ from 'lodash';\n\nexport default {\n  name: \"aw-sunburst-clock\",\n  props: ['date', 'afkBucketId', 'windowBucketId'],\n\n  data: () => {\n    return {\n      starttime: moment(),\n      endtime: moment(),\n      centerMsg: \"Loading...\",\n    }\n  },\n\n  watch: {\n    \"date\": function(to) {\n      this.starttime = moment(to);\n      this.endtime = moment(this.starttime).add(1, 'days');\n      this.visualize();\n    }\n  },\n  mounted: function() {\n    sunburst.create(this.$el);\n    this.starttime = moment(this.date);\n    this.endtime = moment(this.date).add(1, 'days');\n    this.visualize();\n  },\n\n  methods: {\n    todaysEvents: function(bucket_id) {\n      return this.$aw.getEvents(bucket_id, {\n        limit: -1,\n        start: this.starttime.format(), end: this.endtime.format()\n      });\n    },\n\n    visualize: function() {\n      function buildHierarchy(parents, children) {\n          parents = _.sortBy(parents, \"timestamp\", \"desc\");\n          children = _.sortBy(children, \"timestamp\", \"desc\");\n\n          let i_child = 0;\n          for(let i_parent = 0; i_parent < parents.length; i_parent++) {\n              const p = parents[i_parent];\n              const p_start = moment(p.timestamp);\n              const p_end = p_start.clone().add(p.duration, \"seconds\");\n\n              p.children = [];\n              while(i_child < children.length) {\n                  const e = children[i_child];\n                  const e_start = moment(e.timestamp);\n                  const e_end = e_start.clone().add(e.duration, \"seconds\");\n\n                  const before_parent = e_end.isBefore(p_start);\n                  const within_parent = e_start.isAfter(p_start) && e_end.isBefore(p_end);\n                  const after_parent = e_start.isAfter(p_end);\n\n                  // TODO: This isn't correct, yet\n                  if(before_parent) {\n                    // Child is behind parent\n                    //console.log(\"Too far behind: \" + i_child);\n                    i_child++;\n                  } else if(within_parent) {\n                    //console.log(\"Added relation: \" + i_child);\n                    p.children = _.concat(p.children, e);\n                    i_child++;\n                  } else if(after_parent) {\n                    // Child is ahead of parent\n                    //console.log(\"Too far ahead: \" + i_child);\n                    break;\n                  } else {\n                    // TODO: Split events when this happens\n                    console.warn(\"Between parents\");\n                    p.children = _.concat(p.children, e);\n                    i_child++;\n                  }\n              }\n          }\n\n          // Build the root node\n          //console.log(parents);\n          const m_start = moment(_.first(parents).timestamp)\n          const m_end = moment(_.tail(parents).timestamp)\n          const duration = (m_end - m_start) / 1000;\n          return {\n            \"timestamp\": _.first(parents).timestamp,\n            // TODO: If we want a 12/24h clock, this has to change\n            \"duration\": duration,\n            \"data\": {\"title\": \"ROOT\"},\n            \"children\": parents\n          }\n      }\n\n      this.todaysEvents(this.afkBucketId).then((events_afk) => {\n        this.todaysEvents(this.windowBucketId).then((events_window) => {\n          let hierarchy = null;\n          if(events_afk.length > 0 && events_window.length > 0) {\n            hierarchy = buildHierarchy(events_afk, events_window);\n            this.centerMsg = \"Hover to inspect\";\n          } else {\n            // FIXME: This should do the equivalent of \"No data\" when such is the case, but it doesn't.\n            hierarchy = {\n              \"timestamp\": \"\",\n              // TODO: If we want a 12/24h clock, this has to change\n              \"duration\": 0,\n              \"data\": {\"title\": \"ROOT\"},\n              \"children\": []\n            };\n            this.centerMsg = \"No data\";\n          }\n          sunburst.update(this.$el, hierarchy);\n        });\n      });\n    },\n  },\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SunburstClock.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SunburstClock.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SunburstClock.vue?vue&type=template&id=6b529888&scoped=true&lang=pug&\"\nimport script from \"./SunburstClock.vue?vue&type=script&lang=js&\"\nexport * from \"./SunburstClock.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SunburstClock.vue?vue&type=style&index=0&id=6b529888&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6b529888\",\n  null\n  \n)\n\nexport default component.exports","var baseSlice = require('./_baseSlice');\n\n/**\n * Gets all but the first element of `array`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {Array} Returns the slice of `array`.\n * @example\n *\n * _.tail([1, 2, 3]);\n * // => [2, 3]\n */\nfunction tail(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? baseSlice(array, 1, length) : [];\n}\n\nmodule.exports = tail;\n"],"sourceRoot":""}