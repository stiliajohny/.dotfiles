{"version":3,"sources":["webpack:///./src/visualizations/PeriodUsage.vue?c9a2","webpack:///./src/visualizations/periodusage.js","webpack:///src/visualizations/PeriodUsage.vue","webpack:///./src/visualizations/PeriodUsage.vue?b665","webpack:///./src/visualizations/PeriodUsage.vue?e4bb","webpack:///./src/visualizations/PeriodUsage.vue?9644"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticRenderFns","d3","require","_","moment","create","svg_elem","innerHTML","set_status","msg","svg","select","append","attr","text","diagramcolor","diagramcolor_selected","diagramcolor_focused","update","usage_arr","link_prefix","dateformat","length","get_usage_time","day_events","day_event","head","filter","e","data","status","undefined","duration","usage_times","map","longest_usage","Math","max","apply","padding","width","center_elem","floor","each","events","i","usage_time","height","date","timestamp","format","color","offset","x","isSame","rect","style","on","d","j","n","a","getAttribute","me","url","window","location","assign","seconds_to_duration","name","props","watch","periodusage","$el","periodusage_arr","mounted","component"],"mappings":"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","file":"js/chunk-0e0e08d4.451b24ca.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('svg')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","'use strict';\n\nconst d3 = require('d3');\nconst _ = require('lodash');\nconst moment = require('moment');\n\nimport { seconds_to_duration } from '../util/time.js';\n\nfunction create(svg_elem) {\n  // Clear element\n  svg_elem.innerHTML = '';\n}\n\nfunction set_status(svg_elem, msg) {\n  // Select svg canvas\n  svg_elem.innerHTML = '';\n  const svg = d3.select(svg_elem);\n\n  svg\n    .append('text')\n    .attr('x', '5pt')\n    .attr('y', '25pt')\n    .text(msg)\n    .attr('font-family', 'sans-serif')\n    .attr('font-size', '20pt')\n    .attr('fill', 'black');\n}\n\nconst diagramcolor = '#aaa';\nconst diagramcolor_selected = '#fc5';\nconst diagramcolor_focused = '#adf';\n\nfunction update(svg_elem, usage_arr, link_prefix) {\n  const dateformat = 'YYYY-MM-DD';\n\n  // No apps, sets status to \"No data\"\n  if (usage_arr.length <= 0) {\n    set_status(svg_elem, 'No data');\n    return svg;\n  }\n  svg_elem.innerHTML = '';\n  var svg = d3.select(svg_elem);\n\n  function get_usage_time(day_events) {\n    const day_event = _.head(_.filter(day_events, e => e.data.status == 'not-afk'));\n    return day_event != undefined ? day_event.duration : 0;\n  }\n\n  const usage_times = usage_arr.map(day_events => get_usage_time(day_events));\n  let longest_usage = Math.max.apply(null, usage_times);\n  // Avoid division by zero\n  if (longest_usage <= 0) {\n    longest_usage = 0.00000000001;\n  }\n\n  const padding = 0.3 * (100 / (usage_arr.length - 1));\n  const width = 100 / usage_arr.length - padding;\n  const center_elem = Math.floor(usage_arr.length / 2);\n\n  _.each(usage_arr, (events, i) => {\n    const usage_time = get_usage_time(events);\n    const height = 85 * (usage_time / longest_usage);\n    let date = '';\n    if (events.length > 0) {\n      // slice off so it's only the day\n      date = moment(usage_arr[i][0].timestamp).format(dateformat);\n    }\n    const color = i == center_elem ? diagramcolor_selected : diagramcolor;\n    const offset = 50;\n\n    const x = i * padding + i * width + 0.25 * width;\n\n    if (moment(date).isSame(moment(), 'day')) {\n      svg\n        .append('line')\n        .attr('x1', x + width / 2 + '%')\n        .attr('y1', 0)\n        .attr('x2', x + width / 2 + '%')\n        .attr('y2', 200)\n        .attr('style', 'stroke: #888; stroke-width: 2px;')\n        .attr('stroke-dasharray', '4, 2');\n\n      svg\n        .append('text')\n        .attr('x', x + 1.5 * width + '%')\n        .attr('y', '30')\n        .text('Today');\n    }\n\n    const rect = svg\n      .append('rect')\n      .attr('x', x + '%')\n      .attr('y', 101 - height + '%') // Draw rect bottom-up\n      .attr('rx', 3)\n      .attr('ry', 3)\n      .attr(\n        'style',\n        i == center_elem ? 'stroke: black; stroke-width: 1;' : 'stroke: #222; stroke-width: 1;'\n      )\n      .attr('width', width + '%')\n      .attr('height', height + offset + '%')\n      .attr('color', color)\n      .attr('date', date)\n      .attr('data', link_prefix)\n      .style('fill', color)\n      .on('mouseover', () => {\n        rect.style('fill', diagramcolor_focused);\n      })\n      .on('mouseout', (d, j, n) => {\n        const a = n[j];\n        rect.style('fill', a.getAttribute('color'));\n      })\n      .on('click', function(d, j, n) {\n        const me = n[j];\n        const date = d3.select(me).attr('date');\n        const link_prefix = d3.select(me).attr('data');\n        const url = `/#${link_prefix}/${date}`;\n        /* Not the vue-way, but works */\n        window.location.assign(url);\n        /* Hardcoding click behavior also isn't optimal I guess */\n      });\n    rect\n      .append('title')\n      .text(moment(date).format(dateformat) + '\\n' + seconds_to_duration(usage_time));\n  });\n}\n\nexport default {\n  create: create,\n  update: update,\n  set_status: set_status,\n};\n","<template lang=\"pug\">\nsvg\n</template>\n\n<style scoped lang=\"scss\">\nsvg {\n    width: 100%;\n    height: 40pt;\n    border: 1px solid #999;\n    margin-top: 0.2em;\n    margin-bottom: 0.2em;\n    border-radius: 0.5em;\n}\n</style>\n\n<script>\n// NOTE: This is just a Vue.js component wrapper for summary.js\n//       Code should generally go in the framework-independent file.\n\nimport periodusage from './periodusage.js';\n\nexport default {\n  name: \"aw-periodusage\",\n  props: ['periodusage_arr', 'link_prefix'],\n  watch: {\n    \"periodusage_arr\": function() {\n      periodusage.update(this.$el, this.periodusage_arr, this.link_prefix);\n    }\n  },\n  mounted: function() {\n    periodusage.create(this.$el);\n    periodusage.set_status(this.$el, \"Loading...\");\n  }\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PeriodUsage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PeriodUsage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PeriodUsage.vue?vue&type=template&id=606e89be&scoped=true&lang=pug&\"\nimport script from \"./PeriodUsage.vue?vue&type=script&lang=js&\"\nexport * from \"./PeriodUsage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PeriodUsage.vue?vue&type=style&index=0&id=606e89be&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"606e89be\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PeriodUsage.vue?vue&type=style&index=0&id=606e89be&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PeriodUsage.vue?vue&type=style&index=0&id=606e89be&scoped=true&lang=scss&\""],"sourceRoot":""}